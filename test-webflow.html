<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Webflow Test Page - ChatKit Widget</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      line-height: 1.6;
      color: #333;
    }

    /* Header */
    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2rem 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: bold;
    }

    nav a {
      color: white;
      text-decoration: none;
      margin-left: 2rem;
      transition: opacity 0.3s;
    }

    nav a:hover {
      opacity: 0.8;
    }

    /* Hero Section */
    .hero {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 6rem 2rem;
      text-align: center;
    }

    .hero h1 {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .hero p {
      font-size: 1.25rem;
      margin-bottom: 2rem;
      opacity: 0.9;
    }

    .cta-button {
      background: white;
      color: #667eea;
      padding: 1rem 2rem;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      display: inline-block;
      transition: transform 0.3s;
    }

    .cta-button:hover {
      transform: translateY(-2px);
    }

    /* Content Sections */
    .section {
      max-width: 1200px;
      margin: 0 auto;
      padding: 4rem 2rem;
    }

    .section h2 {
      font-size: 2rem;
      margin-bottom: 2rem;
      color: #333;
    }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .feature-card {
      background: #f8f9fa;
      padding: 2rem;
      border-radius: 12px;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .feature-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .feature-card h3 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: #667eea;
    }

    .feature-card p {
      color: #666;
    }

    /* Footer */
    footer {
      background: #2d3748;
      color: white;
      padding: 3rem 2rem;
      margin-top: 4rem;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
    }

    .footer-section h3 {
      margin-bottom: 1rem;
    }

    .footer-section a {
      color: #a0aec0;
      text-decoration: none;
      display: block;
      margin-bottom: 0.5rem;
      transition: color 0.3s;
    }

    .footer-section a:hover {
      color: white;
    }

    /* Instructions Banner */
    .instructions {
      background: #fff3cd;
      border: 2px solid #ffc107;
      padding: 1rem 2rem;
      margin: 2rem;
      border-radius: 8px;
    }

    .instructions h3 {
      color: #856404;
      margin-bottom: 0.5rem;
    }

    .instructions p {
      color: #856404;
      margin-bottom: 0.5rem;
    }

    .instructions code {
      background: #ffeaa7;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
    }

    /* Notification badge pulse animation */
    @keyframes pulse {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.7);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 0 0 6px rgba(255, 59, 48, 0);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(255, 59, 48, 0);
      }
    }

    /* Notification message slide in animation */
    @keyframes slideIn {
      0% {
        opacity: 0;
        transform: translateY(10px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <!-- Instructions Banner -->
  <div class="instructions">
    <h3>Local Testing Instructions</h3>
    <p><strong>1.</strong> Start your Next.js dev server: <code>npm run dev</code></p>
    <p><strong>2.</strong> Open this file in your browser (you may need to use a local server like <code>python3 -m http.server 8000</code> or VS Code Live Server to avoid CORS issues)</p>
    <p><strong>3.</strong> Click the chat bubble in the bottom-right corner to test the widget</p>
    <p><strong>Note:</strong> The iframe loads from <code>http://localhost:3000</code> - make sure your Next.js app is running!</p>
  </div>

  <!-- Header -->
  <header>
    <div class="header-content">
      <div class="logo">Your Brand</div>
      <nav>
        <a href="#features">Features</a>
        <a href="#about">About</a>
        <a href="#contact">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <h1>Welcome to Your Webflow Site</h1>
    <p>Test your ChatKit widget integration with this local replica</p>
    <a href="#features" class="cta-button">Get Started</a>
  </section>

  <!-- Features Section -->
  <section class="section" id="features">
    <h2>Features</h2>
    <div class="features">
      <div class="feature-card">
        <h3>Easy Integration</h3>
        <p>Seamlessly integrate ChatKit into your Webflow site with just a few lines of code.</p>
      </div>
      <div class="feature-card">
        <h3>Beautiful UI</h3>
        <p>A modern, responsive chat interface that matches your brand and delights users.</p>
      </div>
      <div class="feature-card">
        <h3>Powerful AI</h3>
        <p>Leverage OpenAI's advanced AI models to provide intelligent responses to your users.</p>
      </div>
      <div class="feature-card">
        <h3>Customizable</h3>
        <p>Easily customize prompts, themes, and behavior to match your specific use case.</p>
      </div>
      <div class="feature-card">
        <h3>Analytics Ready</h3>
        <p>Built-in hooks for tracking user interactions and gathering valuable insights.</p>
      </div>
      <div class="feature-card">
        <h3>Mobile Optimized</h3>
        <p>Works perfectly on all devices, from desktop to mobile.</p>
      </div>
    </div>
  </section>

  <!-- About Section -->
  <section class="section" id="about">
    <h2>About This Test Page</h2>
    <p style="margin-bottom: 1rem;">
      This page simulates your Webflow site locally, allowing you to test the ChatKit widget integration
      without deploying. You can modify the chat widget behavior by editing your Next.js app code and see
      the changes in real-time.
    </p>
    <p style="margin-bottom: 1rem;">
      The chat bubble in the bottom-right corner opens an iframe that loads your local Next.js app
      (http://localhost:3000). This is the same setup used in your Webflow production site, but pointing
      to your development server instead.
    </p>
    <p>
      Try interacting with different elements on the page to test how the chat widget behaves with your
      actual content. You can test scrolling, overlapping content, mobile responsiveness, and more.
    </p>
  </section>

  <!-- Footer -->
  <footer id="contact">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Company</h3>
        <a href="#">About Us</a>
        <a href="#">Careers</a>
        <a href="#">Press</a>
      </div>
      <div class="footer-section">
        <h3>Product</h3>
        <a href="#">Features</a>
        <a href="#">Pricing</a>
        <a href="#">Documentation</a>
      </div>
      <div class="footer-section">
        <h3>Support</h3>
        <a href="#">Help Center</a>
        <a href="#">Contact Us</a>
        <a href="#">Status</a>
      </div>
      <div class="footer-section">
        <h3>Legal</h3>
        <a href="#">Privacy Policy</a>
        <a href="#">Terms of Service</a>
        <a href="#">Cookie Policy</a>
      </div>
    </div>
  </footer>

  <!-- Chat Widget (from webflow.html) -->
  <!-- Notification Message Bubble -->
  <div id="notification-message"
       style="display: none; position: fixed; bottom: 100px; right: 24px; background-color: white; color: #333; padding: 14px 18px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); z-index: 2147483646; max-width: 240px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 15px; animation: slideIn 0.4s ease-out; font-weight: 500;">
    How can I help? ðŸ‘‹
    <!-- Message tail/pointer -->
    <div style="position: absolute; bottom: -6px; right: 20px; width: 14px; height: 14px; background-color: white; transform: rotate(45deg);"></div>
  </div>

  <!-- Chat Bubble -->
  <div id="chat-bubble"
       style="position: fixed; bottom: 24px; right: 24px; width: 64px; height: 64px; cursor: pointer; z-index: 2147483647; transition: transform 0.3s;"
       onmouseover="this.style.transform='scale(1.1)'"
       onmouseout="this.style.transform='scale(1)'">
    <div style="width: 100%; height: 100%; border-radius: 50%; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
      <img src="avatar.png" alt="Chat" style="width: 100%; height: 100%; object-fit: cover;">
    </div>
    <!-- Notification Badge (small dot indicator) -->
    <div id="notification-badge"
         style="display: none; position: absolute; top: -2px; right: -2px; background-color: #FF3B30; border-radius: 50%; width: 16px; height: 16px; border: 2px solid white; animation: pulse 2s infinite;">
    </div>
  </div>

  <!-- Chat iframe (hidden by default) -->
  <iframe id="chat-iframe"
          src="http://localhost:3000/"
          style="display: none; position: fixed; bottom: 100px; right: 24px; width: 400px; height: 600px; border: none; border-radius: 16px; box-shadow: 0 0 24px rgba(0,0,0,0.2); z-index: 2147483646;">
  </iframe>

  <script type="text/javascript">
    (function() {
      const NOTIFICATION_DELAY_MS = 100;
      const AUDIO_URL = "https://efoawoucannrubkjicli.supabase.co/storage/v1/object/public/calls/new-notification-3-398649.mp3";

      // Elements
      const bubble = document.getElementById('chat-bubble');
      const frame = document.getElementById('chat-iframe');
      const badge = document.getElementById('notification-badge');
      const message = document.getElementById('notification-message');

      // State
      let open = false;
      let notificationFired = false;
      let gestureSeen = false;

      // Audio setup
      const audio = new Audio(AUDIO_URL);
      audio.preload = 'auto';

      // Handle user gesture
      function onGesture() {
        if (gestureSeen) return;
        gestureSeen = true;
        maybeShowNotification();
        ["pointerdown", "click", "touchstart", "keydown"].forEach(evt =>
          document.removeEventListener(evt, onGesture, { passive: true })
        );
      }

      ["pointerdown", "click", "touchstart", "keydown"].forEach(evt =>
        document.addEventListener(evt, onGesture, { passive: true })
      );

      // Play notification sound
      function playChime() {
        audio.play().catch(() => {});
      }

      // Show notification after user interaction
      function maybeShowNotification() {
        if (notificationFired || !gestureSeen) return;
        notificationFired = true;
        setTimeout(() => {
          message.style.display = 'block';
          badge.style.display = 'block';
          playChime();
        }, NOTIFICATION_DELAY_MS);
      }

      // Hide notification
      function hideNotification() {
        message.style.display = 'none';
        badge.style.display = 'none';
      }

      // Toggle chat
      bubble.addEventListener('click', () => {
        open = !open;
        frame.style.display = open ? 'block' : 'none';
        if (open) hideNotification();
      });

      // Close on escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && open) {
          open = false;
          frame.style.display = 'none';
        }
      });

      // Listen for close message from iframe
      window.addEventListener('message', (event) => {
        if (event.data && event.data.type === 'CLOSE_CHAT') {
          open = false;
          frame.style.display = 'none';
        }
      });
    })();
  </script>
</body>
</html>
